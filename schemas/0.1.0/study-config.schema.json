{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "/schemas/0.1.0/study-config",
    "title": "study-config.json",
    "description": "A Boa study template configuration file.",
    "type": "object",
    "required": [
        "datasets",
        "queries",
        "$schema"
    ],
    "additionalProperties": false,
    "properties": {
        "datasets": {
            "description": "List of all datasets used in the study.",
            "type": "object",
            "additionalProperties": false,
            "minProperties": 1,
            "propertyNames": {
                "type": "string",
                "minLength": 1
            },
            "patternProperties": {
                ".+": {
                    "description": "A mapping of a name used in the config for a dataset to the actual Boa dataset name.",
                    "type": "string",
                    "minLength": 1
                }
            }
        },
        "queries": {
            "description": "A list of all the Boa queries to run and where to store the outputs.",
            "type": "object",
            "additionalProperties": false,
            "minProperties": 1,
            "propertyNames": {
                "type": "string",
                "minLength": 1
            },
            "patternProperties": {
                ".+\\.txt$": {
                    "description": "An output generated by a Boa query.",
                    "type": "object",
                    "required": [
                        "query",
                        "dataset"
                    ],
                    "additionalProperties": false,
                    "properties": {
                        "query": {
                            "description": "The path to the Boa query file.  File must live in boa/ (but do not include the prefix here).",
                            "type": "string",
                            "pattern": "^.+\\.boa$"
                        },
                        "dataset": {
                            "description": "The study name of the dataset to query, as defined in \"datasets\".",
                            "type": "string",
                            "minLength": 1
                        },
                        "substitutions": {
                            "description": "(optional) Local query template substitutions.  These can override any global substitutions of the same target.",
                            "$ref": "#/$defs/substitutions"
                        },
                        "gendupes": {
                            "description": "(optional) If this query built a hashes file, process it to generate a dupes file.",
                            "type": "object",
                            "required": [
                                "output"
                            ],
                            "additionalProperties": false,
                            "properties": {
                                "output": {
                                    "description": "Path to store the generated TXT file.  Must live in data/txt/ (but do not include the prefix here).",
                                    "type": "string",
                                    "pattern": "^.+\\.txt$"
                                },
                                "csv": {
                                    "description": "(optional) Path to store the converted CSV file.  Must live in data/csv/ (but do not include the prefix here).",
                                    "type": "string",
                                    "pattern": "^.+\\.csv$"
                                }
                            }
                        },
                        "csv": {
                            "description": "(optional) TODO",
                            "type": "object",
                            "required": [
                                "output"
                            ],
                            "additionalProperties": false,
                            "properties": {
                                "output": {
                                    "description": "TODO",
                                    "type": "string",
                                    "pattern": "^.+\\.csv$"
                                },
                                "test": {
                                    "description": "(optional) TODO",
                                    "type": "array",
                                    "items": {
                                        "description": "TODO",
                                        "type": "string",
                                        "minLength": 1
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "substitutions": {
            "description": "(optional) Global query template substitutions.",
            "$ref": "#/$defs/substitutions"
        },
        "$schema": {
            "description": "study-config JSON schema",
            "type": "string",
            "pattern": "^schemas/\\d+\\.\\d+\\.\\d+/study-config.schema.json$"
        }
    },
    "$defs": {
        "substitutions": {
            "type": "array",
            "substitution": {
                "description": "A template substitution",
                "type": "object",
                "required": [
                    "target"
                ],
                "oneOf": [
                    {
                        "required": [
                            "replacement"
                        ]
                    },
                    {
                        "required": [
                            "file"
                        ]
                    }
                ],
                "additionalProperties": false,
                "properties": {
                    "target": {
                        "description": "A target in the template to substitute.",
                        "type": "string",
                        "minLength": 1
                    },
                    "replacement": {
                        "description": "A string to replace the target with.",
                        "type": "string"
                    },
                    "file": {
                        "description": "Load a query snippet and replace the target with the file contents.",
                        "type": "string",
                        "minLength": 1
                    }
                }
            }
        }
    }
}